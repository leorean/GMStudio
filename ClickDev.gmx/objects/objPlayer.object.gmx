<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>mskPlayer</spriteName>
  <solid>-1</solid>
  <visible>-1</visible>
  <depth>-25</depth>
  <persistent>0</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>xVel = 0;
yVel = 0;
yGrav = .07;

offx = 0;
offy = 0;

dir = RIGHT;

state = IDLE;
stateTimer = 3*SEC;
statePrev = state;

happiness = 50;
tidiness = 50;
sleepiness = 50;
hungriness = 100;

w = abs(bbox_left-bbox_right);
h = abs(bbox_top-bbox_bottom);

fCur = 0;
fMax = 2;
frame = 0;

stateTimer = 0;
maxPoopTimer = 60*SEC;
poopTimer = maxPoopTimer;

onGround = false;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>//++++begin variables++++
if (statePrev != state) fCur = 0;

//++++state stuff++++

/*
if (hungriness &lt; 30 || tidiness &lt; 30 || sleepiness &lt; 30)
    happiness = max(happiness - .005,0);
*/

happiness = (tidiness + sleepiness + hungriness) / 3;

if (state == WALK)
{
    xVel = sign(dir)*.5;
    if (x + xVel &lt;= TILE || x + xVel &gt;= (WIDTH-TILE))
    {
        xVel = 0;
        dir = -dir;
    }
}

if (state == SLEEP)
{
    sleepiness = min(sleepiness + .01,100);
} else
{
    sleepiness = max(sleepiness - .01,0);
}

if (state == EAT)
{
    hungriness = min(hungriness+.1,100);
} else
    hungriness = max(hungriness-.008,0);

  
tidiness = clamp(100-35*instance_number(objPoo),0,100);
/*
if (state == CLEAN)
{
    tidiness = min(tidiness+.05,100);
} else
    tidiness = max(tidiness-.001,0);
*/

if (state == YAWN)
{
    xVel = 0;
    //after animation, immediately go to state change
    if (fCur &gt;= fMax-fSpeed)
        stateTimer = 0;
    else
        stateTimer = 1*SEC;
}
var fingerCount = 0;
for (i = 0; i &lt; 5; i++)
    if (device_mouse_check_button(i,mb_any))
        fingerCount++;
        
for (i = 0; i &lt; fingerCount+1; i++)
{
    if (collision_point(device_mouse_x(i),device_mouse_y(i),id,true,false)
    &amp;&amp; !place_meeting(x,y,objPoo) &amp;&amp; global.cursor == C_GRAB)
    {
        if (device_mouse_check_button(i,mb_left))
        {
            x = device_mouse_x(i)+offx;
            y = device_mouse_y(i)+offy;
            xVel = 0;
            yVel = 0;
            
            //xVel = lengthdir_x(-min(4,abs(device_mouse_x(i)-x)),point_direction(device_mouse_x(i),device_mouse_y(i),x,y));
            //yVel = lengthdir_y(-min(4,abs(device_mouse_y(i)-y)),point_direction(device_mouse_x(i),device_mouse_y(i),x,y));
            //yVel = min(1,lengthdir_y(1,point_direction(device_mouse_x(i),device_mouse_y(i),x,y)));
            
            
            if (state != HAPPY)
            {
                state = IDLE;
                stateTimer = 1*SEC;
            }
        } else
        {
            offx = x-device_mouse_x(i);
            offy = y-device_mouse_y(i);
        }
    //if (in(device_mouse_y(i),7*TILE,14*TILE))
        if (device_mouse_check_button_pressed(i,mb_any))
        {
            
                //if (happiness &lt; 100 &amp;&amp; (sleepiness &gt; 30 &amp;&amp; tidiness &gt; 30 &amp;&amp; hungriness &gt; 30))
                //|| (happiness == min(happiness,hungriness,tidiness,sleepiness)))
                
            /*if (onGround &amp;&amp; ceil(happiness) == 100)
            {
                xVel = lengthdir_x(.2,point_direction(device_mouse_x(i),device_mouse_y(i),x,y));
                yVel = min(-1,lengthdir_y(1,point_direction(device_mouse_x(i),device_mouse_y(i),x,y)));
            }*/
            /*
            switch(global.cursor)
            {
                case C_GRAB:
                    state = HAPPY;
                    //var sym = instance_create(x,5*TILE,objSymbol);
                    //sym.type = C_GRAB;
                break;
                case C_SLEEP:
                    state = YAWN;
                    sleepiness = min(sleepiness+1,100);

                    var sym = instance_create(x,5*TILE,objSymbol);
                    sym.type = C_SLEEP;
                break;
                case C_CLEAN:
                    state = CLEAN;
                    tidiness = min(tidiness+1,100);
                    var sym = instance_create(x,5*TILE,objSymbol);
                    sym.type = C_CLEAN;
                break;
                case C_FEED:
                    state = EAT;
                    hungriness = min(hungriness+1,100);
                    var sym = instance_create(x,5*TILE,objSymbol);
                    sym.type = C_FEED;
                break;
            }*/
            /*
            if (tidiness == min(tidiness,hungriness,sleepiness))
                tidiness = min(tidiness+.5,100);//show_debug_message("tidiniess:"+string(tidiness));}
            if (hungriness == min(tidiness,hungriness,sleepiness))
                hungriness = min(hungriness+.5,100);//show_debug_message("hungriness:"+string(hungriness));}
            if (sleepiness == min(tidiness,hungriness,sleepiness))
                sleepiness = min(sleepiness+.5,100);//show_debug_message("sleepiness:"+string(sleepiness));}
                
            //tidiness = max(tidiness-.1,0);
            */
            
            state = HAPPY;
            
            var cpc = .5*global.cpc+.5*global.cpc*(happiness/100);
            
            global.xp += cpc;
            global.c += cpc;
            global.cmax += cpc;
                
            var txt = instance_create(x-2+random(4),y-2+random(4)-TILE,objText);
            txt.text = "+"+string(bigNumber(cpc))+"";
            
            stateTimer = 1*SEC;         
        }                
    }
}

if (keyboard_check_pressed(ord('E')))
{
    state = EAT;
    stateTimer = 5*SEC;
}

//++++state transitions++++
poopTimer = max(poopTimer - 1,0);
stateTimer = max(stateTimer - 1, 0);

if (!stateTimer)
{
    stateTimer = choose(1,2,3)*SEC;
    
    //TODO: poop push notification
    if (!poopTimer &amp;&amp; onGround &amp;&amp; state == IDLE &amp;&amp; !place_meeting(x,y,objPoo))
    {
        instance_create(x,y+TILE,objPoo);
        poopTimer = maxPoopTimer;
    }
    
    switch(state)
    {
        case HAPPY:
            state = IDLE;         
        break;
        case IDLE:
            state = choose(WALK,IDLE,CLEAN);
            
            if (state == WALK)
                dir = choose(LEFT,RIGHT);
            
            //if (tidiness &lt; 50 &amp;&amp; min(hungriness,sleepiness,tidiness) == tidiness)
            //    state = choose(IDLE,CLEAN);
                
            if (state != WALK &amp;&amp; min(hungriness,sleepiness,tidiness) == sleepiness)
            {
                if (sleepiness &lt; 50)
                    state = choose(IDLE,YAWN);
                if (sleepiness &lt; 25)
                    state = YAWN;
                if (sleepiness &lt; 10)
                    state = SLEEP;
                    
            }
            if (hungriness &lt; 50 &amp;&amp; min(hungriness,sleepiness,tidiness) == hungriness)
                state = EAT; //TODO: if food is here
        break;
        case WALK:
            state = choose(WALK,IDLE,CLEAN);
        break;
        case SLEEP:
            if (sleepiness == 100)
                state = IDLE;
            /*
                state = choose(SLEEP,IDLE);
            else if (sleepiness &gt; 60 &amp;&amp; (hungriness &lt;= 30 || tidiness &lt;= 30))
                state = IDLE;
            */
        break;
        case CLEAN:
            state = choose(CLEAN,IDLE);
        break;
        case EAT:
            if (hungriness == 100 || (hungriness &gt; 60 &amp;&amp; (sleepiness &lt;= 30 || tidiness &lt;= 30)))
                state = IDLE;
        break;
        case YAWN:
            state = choose(IDLE,WALK,SLEEP);
            stateTimer = 2*SEC;
            //if (sleepiness &lt;= 20)
            //    state = choose(YAWN,IDLE);
        break;
        
    }
    if (state == YAWN) fCur = 0; //make sure the animation starts properly
}



//++++physics+++++

//onGround = place_meeting(x,y+1,objGround)&amp;&amp;yVel&gt;=0;
onGround = (y &gt;= GROUND &amp;&amp; yVel &gt;= 0);

yVel += yGrav;

//if (y +yVel &lt; 10.5*TILE)
//    yVel = -yVel/4;

y = clamp(y,7*TILE,GROUND);
if (!onGround)//place_meeting(x,y+yVel,objGround))
    y += yVel;
else
{
    yVel = 0;
    
    if(state != WALK)
        xVel *= .9;
   
}

x = clamp(x,TILE,WIDTH-TILE);
if (x + xVel &gt;= TILE &amp;&amp; x + xVel &lt;= WIDTH-TILE)
    x += xVel;
else
{
    x -= 3*sign(xVel);
    xVel = -xVel;
}
    
//++++end variables++++
statePrev = state;


</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>//var row = 0;
switch(state)
{
    case IDLE:
        row = 1;
        fSpeed = .05;
        fMax = 2;        
    break;
    case HAPPY:
        row = 0;
        fSpeed = .1;
        fMax = 2;
    break;
    case WALK:
        row = 2;
        fSpeed = .15;
        fMax = 4;
    break;    
    case SLEEP:
        row = 3;
        fSpeed = .05;
        fMax = 4;
    break;
    case CLEAN:
        row = 4;
        fSpeed = .1;
        fMax = 4;
    break;
    case EAT:
        row = 5;
        fSpeed = .1;
        fMax = 4;
    break;
    case YAWN:
        row = 6;
        if (frame == 2)
            fSpeed = .02;
        else
            fSpeed = .1;
        fMax = 4;
    break;    
}

if (!onGround &amp;&amp; (state == HAPPY || state == IDLE)) col = 2;
    else col = 0;

fCur = (fCur + fSpeed) % fMax;
frame = floor(fCur);

draw_sprite_part_ext(sprPlayer,-1,frame*3*TILE+col*3*TILE,row*3*TILE,3*TILE,3*TILE,floor(x)+1.5*TILE-3*TILE*(dir==RIGHT),floor(y)-1.5*TILE,sign(dir),1,c_white,1);
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
